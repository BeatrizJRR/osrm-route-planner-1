<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>OSRM Route Planner</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <style>
    #map { height: 100vh; width: 100%; margin: 0; padding: 0; }
    body { margin: 0; }
  </style>
</head>
<body>
  <div id="map"></div>
  <script>
    var map = L.map('map').setView([38.736946, -9.142685], 13); // Lisboa

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '© OpenStreetMap contributors'
    }).addTo(map);

    var markers = [];
    var routeLayer;

    map.on('click', function(e) {
      if (markers.length >= 2) {
        // Limpa marcadores e rota anteriores
        markers.forEach(m => map.removeLayer(m));
        markers = [];
        if (routeLayer) {
          map.removeLayer(routeLayer);
        }
      }

      var marker = L.marker(e.latlng).addTo(map);
      markers.push(marker);

      if (markers.length === 2) {
        var start = markers[0].getLatLng();
        var end = markers[1].getLatLng();

        // Chamada à API OSRM
        var url = `https://router.project-osrm.org/route/v1/driving/${start.lng},${start.lat};${end.lng},${end.lat}?overview=full&geometries=geojson`;

        fetch(url)
          .then(response => response.json())
          .then(data => {
            if (data.routes && data.routes.length > 0) {
              var route = data.routes[0].geometry;
              routeLayer = L.geoJSON(route).addTo(map);
              map.fitBounds(routeLayer.getBounds());
            } else {
              alert("Não foi possível calcular a rota.");
            }
          })
          .catch(err => console.error(err));
      }
    });
  </script>
</body>
</html>

